{
  "hash": "793772cbe5289f7de923e750ee1daf31",
  "result": {
    "markdown": "---\ntitle: \"多数群の比較：二元配置分散分析\"\nsubtitle: Comparing multiple groups with Two-Way ANOVA\nformat: \n  html:\n    html-math-method: katex\nreference-location: margin\ncitation-location: margin\nbibliography: anova.bib\n---\n\n::: {.cell warnings='false'}\n\n:::\n\n\n\n**二元配置分散分析 (Two-Way ANOVA)** 2 種類の因子（要因）を同時に比較するときに使用する。\n\n**二元配置分散分析の帰無仮説**\n\n* $\\mu_{A1} = \\mu_{A2} = \\cdots = \\mu_{Ai}$ (要因Aの主効果)\n* $\\mu_{B1} = \\mu_{B2} = \\cdots = \\mu_{Bj}$ (要因Bの主効果)\n* $\\mu_{ABij} = 0\\text{ for all }i,j$ (相互作用ABまたは交互作用ABの効果)\n\n**フルモデルは: **\n\n$$x_{ijk} = \\mu_{Ai}+\\mu_{Bj} + \\mu_{ABij} + \\epsilon_{ijk}$$\n\n\n水準 $i$, $j$, とサンプル $k$ の値は $x_{ijk}$。 \n因子 $A$ の水準 $i$ ごとの平均値は $\\mu_{Ai}$。\n因子 $B$ の水準 $i$ ごとの平均値は $\\mu_{Bi}$。\n\n交互作用 $AB$ の $i,j$ 効果の平均値は $\\mu_{ABij}$。\n残渣（誤差項）は $\\epsilon_{ijk}$。\n\n## Two-Way ANOVA Table (二元配置分散分析表)\n\n\n:::{.smalltable}\n\n::: {.cell}\n::: {.cell-output-display}\n|Factor |Degrees-of-freedom (df) |Sum-of-Squares (SS) |Mean-square (MS)              |F-value          |P-value                       |\n|:------|:-----------------------|:-------------------|:-----------------------------|:----------------|:-----------------------------|\n|A      |$df_A = I-1$            |$SS_A$              |$MS_A = SS_A / df_A$          |$MS_A / MS_R$    |$qf(1-\\alpha, df_A, df_R)$    |\n|B      |$df_B = J-1$            |$SS_B$              |$MS_B = SS_B / df_B$          |$MS_B / MS_R$    |$qf(1-\\alpha, df_B, df_R)$    |\n|AB     |$df_{AB} = (I-1)(J-1)$  |$SS_{AB}$           |$MS_{AB} = SS_{AB} / df_{AB}$ |$MS_{AB} / MS_R$ |$qf(1-\\alpha, df_{AB}, df_R)$ |\n|e      |$df_R = IJ(K-1)$        |$SS_R$              |$MS_R = SS_R / df_R$          |                 |                              |\n|       |$df_T = IJK-1$          |$SS_T$              |                              |                 |                              |\n:::\n:::\n\n:::\n\n\n$A$ と $B$ は主効果、\n$e$ は残渣、\n$I$ と $J$ は各因子の水準、\n$K$ はサンプル数です。\n$SS_A$ と $SS_B$ は水準間平方和、\n$SS_{AB}$ は相互作用平方和、\n$SS_R$ は残渣平方和、\n$SS_T$ は総平方和です。\n$MS_A$ と $MS_B$ は水準間平均平方、\n$MS_{AB}$ は相互作用平均平方、\n$MS_R$ は残渣平均平方です。\n平均平方の比率はF値です。\n\n:::{.callout-important}\n## 平方和は他にもある\n上述した分散分析表は Type I 平方和 (SS) を求めています。\nこのとき、$SS(A)$, $SS(B|A)$, $SS(AB|A,B)$ です。\n分散分析の結果は因子に順序とに依存し、非釣り合い型データに合わない。\n\nType II 平方和は、$SS(A|B)$ と $SS(B|A)$ のみです。相互作用はありません。\n分散分析の結果は因子に順序とに依存しないが、非釣り合い型データに合わない。\n\nType III 平方和は、$SS(A|B, AB)$, $SS(B|A, AB)$, $SS(AB|A,B)$ です。\n分散分析の結果は因子に順序とに依存しない、非釣り合い型データにも使えるが、\n必ず`contr.sum` を設定しなければならない。\n:::\n\n平方和の非釣り合い型データの問題については、@Hector2010, @Langsrud2003 を参考にしてください。\n\n## Type I 平方和の方程式\n\n$$\n\\begin{split}\n\\overbrace{\\sum_{i=1}^I\\sum_{j=1}^J\\sum_{k=1}^K(x_{ijk} - \\overline{\\overline{x}})^2 }^{\\text{総平方和}\\;(SS_T)} =\n\\overbrace{JK\\sum_{i=1}^I(\\overline{x}_{i}-\\overline{\\overline{x}})^2}^{\\text{水準間平方和}\\;SS_A} +\n\\overbrace{IK\\sum_{j=1}^J(\\overline{x}_{j}-\\overline{\\overline{x}})^2}^{\\text{水準間平方和}\\;SS_B} \\\\ +\n\\underbrace{K\\sum_{i=1}^I\\sum_{j=1}^J(\\overline{x}_{ij} + \\overline{\\overline{x}})^2}_{\\text{相互作用平方和}\\;SS_{AB}} +\n\\underbrace{\\sum_{i=1}^I\\sum_{j=1}^J\\sum_{k=1}^K(x_{ijk} - \\overline{x}_{ij})^2}_{\\text{残渣平方和}\\;SS_R}\n\\end{split}\n$$\n\n$\\bar{x}_i$ is the sample mean (標本平均) and $\\bar{\\bar{x}}$ is the global mean (総平均).\n\n# R コード\n\nデータはクラウドからダウンロードしました。\nクラウドに CSV ファイルとして公開していると、そのまま読み込むことができます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nURL = \"https://raw.githubusercontent.com/dzchilds/stats-for-bio/master/data_csv/FESTUCA.CSV\"\nfestuca = read_csv(URL)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n* 観測値: *Festuca ovina* (ウシノケグサ) の康重量　dry weight (g) [K = 5]\n* A因子: 土壌の pH (3.5 or 5.5) [I = 2]\n* B因子: *Calluna vulgaris* (ギョリュウモドキ) の存在 [J = 2]\n\nデータの可視化するまえに、変数を因子に変換します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfestuca = festuca |> \n  mutate(\n    pH = factor(pH),\n    Calluna = factor(Calluna))\n```\n:::\n\n\n上のコードは次のように諸略できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfestuca = festuca |> mutate(across(c(pH, Calluna), factor))\n```\n:::\n\n\nでは、作図。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(festuca) + \n  geom_point(aes(x = pH, y = Weight, color = Calluna),\n             size = 2,\n             position = position_dodge(0.25)) +\n  scale_x_discrete(\"pH\") + \n  scale_y_continuous(\"Dry weight (g)\") +\n  scale_color_viridis_d(end = 0.8) + \n  theme(legend.position = c(0,1),\n        legend.justification = c(0,1),\n        legend.background = element_blank())\n```\n\n::: {.cell-output-display}\n![](anova2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## 二元配置分散分析\n\n分散分析の結果。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfullmodel_treatment = lm(Weight ~ pH + Calluna + pH:Calluna, data = festuca)\nanova(fullmodel_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: Weight\n           Df  Sum Sq Mean Sq F value     Pr(>F)    \npH          1 19.9800 19.9800 28.1792 0.00007065 ***\nCalluna     1 10.2102 10.2102 14.4001    0.00159 ** \npH:Calluna  1  5.3976  5.3976  7.6126    0.01397 *  \nResiduals  16 11.3446  0.7090                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nモデル係数の結果。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fullmodel_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Weight ~ pH + Calluna + pH:Calluna, data = festuca)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-1.156 -0.603 -0.138  0.732  1.272 \n\nCoefficients:\n                       Estimate Std. Error t value    Pr(>|t|)    \n(Intercept)              3.3680     0.3766   8.944 0.000000127 ***\npHpH5.5                  3.0380     0.5326   5.705 0.000032562 ***\nCallunaPresent          -0.3900     0.5326  -0.732       0.475    \npHpH5.5:CallunaPresent  -2.0780     0.7531  -2.759       0.014 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.842 on 16 degrees of freedom\nMultiple R-squared:  0.7583,\tAdjusted R-squared:  0.713 \nF-statistic: 16.73 on 3 and 16 DF,  p-value: 0.00003447\n```\n:::\n:::\n\n\n因子ごとの比較は `emmeans` パッケージの `emmeans()` 関数でします。\n`object` 引数に、処理するモデルを渡します。\n`formula` には、A因子 と B因子をモデル式として、渡します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmip(object = fullmodel_treatment, \n      formula = pH ~ Calluna)\n```\n\n::: {.cell-output-display}\n![](anova2_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n図で確認したと、ペアごとの比較をして、t値を求めます。\n`object` 引数に、処理するモデルを渡します。\n\nB因子の水準内のペアごとの比較をしたい場合は、`specs` に `pairwise ~ A因子 | B因子` を渡します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(object = fullmodel_treatment, specs = pairwise ~ pH | Calluna)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\nCalluna = Absent:\n pH    emmean    SE df lower.CL upper.CL\n pH3.5   3.37 0.377 16     2.57     4.17\n pH5.5   6.41 0.377 16     5.61     7.20\n\nCalluna = Present:\n pH    emmean    SE df lower.CL upper.CL\n pH3.5   2.98 0.377 16     2.18     3.78\n pH5.5   3.94 0.377 16     3.14     4.74\n\nConfidence level used: 0.95 \n\n$contrasts\nCalluna = Absent:\n contrast      estimate    SE df t.ratio p.value\n pH3.5 - pH5.5    -3.04 0.533 16  -5.705  <.0001\n\nCalluna = Present:\n contrast      estimate    SE df t.ratio p.value\n pH3.5 - pH5.5    -0.96 0.533 16  -1.803  0.0903\n```\n:::\n:::\n\n\n全ペア毎の比較は、次の通りです。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(object = fullmodel_treatment, specs = pairwise ~ pH : Calluna, adjust = \"tukey\") |> \n  summary(infer = T)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\n pH    Calluna emmean    SE df lower.CL upper.CL t.ratio p.value\n pH3.5 Absent    3.37 0.377 16     2.57     4.17   8.944  <.0001\n pH5.5 Absent    6.41 0.377 16     5.61     7.20  17.011  <.0001\n pH3.5 Present   2.98 0.377 16     2.18     3.78   7.908  <.0001\n pH5.5 Present   3.94 0.377 16     3.14     4.74  10.457  <.0001\n\nConfidence level used: 0.95 \n\n$contrasts\n contrast                      estimate    SE df lower.CL upper.CL t.ratio\n pH3.5 Absent - pH5.5 Absent      -3.04 0.533 16   -4.562   -1.514  -5.705\n pH3.5 Absent - pH3.5 Present      0.39 0.533 16   -1.134    1.914   0.732\n pH3.5 Absent - pH5.5 Present     -0.57 0.533 16   -2.094    0.954  -1.070\n pH5.5 Absent - pH3.5 Present      3.43 0.533 16    1.904    4.952   6.437\n pH5.5 Absent - pH5.5 Present      2.47 0.533 16    0.944    3.992   4.634\n pH3.5 Present - pH5.5 Present    -0.96 0.533 16   -2.484    0.564  -1.803\n p.value\n  0.0002\n  0.8827\n  0.7118\n  <.0001\n  0.0014\n  0.3080\n\nConfidence level used: 0.95 \nConf-level adjustment: tukey method for comparing a family of 4 estimates \nP value adjustment: tukey method for comparing a family of 4 estimates \n```\n:::\n:::\n\n\n## 釣り合い型データと直交性について\n\n:::{.callout-notes}\n## 釣り合い型データ (balanced data)\n\n各因子水準のデータ数は同じであること\n:::\n\n:::{.callout-notes}\n## 直行性 (orthogonality)\n\n説明変数同士の内積 (inner product) はゼロと意味します。\nベクトルとした場合、ベクトル間の角度が 90°であること。\nつまり、説明変数がお互いに相関していないこと。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example of calculating the inner product of two 3d vectors.\n#| echo: false\n#| eval: false\nk  = c(rnorm(3))\nx1 = c(rnorm(2),0)\nx1 = x1 - as.vector(x1 %*% k) * k / sqrt(sum(k^2))^2\nx2 = pracma::cross(k,x1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_segment(aes(x = 0, y = 0, xend = 1, yend = 1)) +\n  geom_segment(aes(x = 0, y = 0, xend = -1, yend = 1)) +\n  geom_text(aes(x = 1, y =1, label = \"(1,1)\"), vjust = 0) +\n  geom_text(aes(x = -1, y =1, label = \"(-1,1)\"), vjust = 0) +\n  geom_label(aes(x = 0, y = sqrt(2*(0.5^2)), label = \"90°\")) +\n  geom_curve(aes(x = 0.5, y = 0.5, xend = -0.5, yend = 0.5),\n             arrow = arrow(ends = \"both\", type = \"closed\")) +\n  scale_x_continuous(expand = expansion(add = 0.2)) +\n  scale_y_continuous(expand = expansion(add = 0.2)) +\n  coord_equal()\n```\n\n::: {.cell-output-display}\n![著効性のあるベクトルのペア](anova2_files/figure-html/unnamed-chunk-14-1.png){width=288}\n:::\n:::\n\n\n説明変数の係数 $x_1$ と $x_2$ の内積がゼロになること。\n\n$$\n\\begin{aligned}\nx_1 &= \\begin{bmatrix}\n-1 & 1\n\\end{bmatrix} \\\\\nx_2 &= \\begin{bmatrix}\n1 & 1\n\\end{bmatrix} \n\\end{aligned}\n$$\n\n$$\nx_1^T \\cdot x_2 = \\begin{bmatrix}\n-1 & 1\n\\end{bmatrix}\n\\begin{bmatrix}\n1 \\\\ 1\n\\end{bmatrix} = (-1 \\times 1) + (1 \\times 1) = 0\n$$\n:::\n\n\n\n::: {.cell hash='anova2_cache/html/unnamed-chunk-15_4eeca26e5691bcafdd0d22586b48e1f3'}\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'pH'. You can override using the `.groups`\nargument.\n`summarise()` has grouped output by 'name'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![釣り合い型データではないとき、Type-I 平方和を用いたとき,　第2種の誤りを起こすことが高くなります。つまり、誤って帰無仮説を採択することが増えます。](anova2_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\nつまり、因子の水準毎のデータ数が異なるとき、係数のデフォルト比 (`contr.treatment`) と デフォルトの平方和 (Type-I) の解析は誤りです。\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'pH'. You can override using the `.groups`\nargument.\n```\n:::\n:::\n\n\n解析用のデータ数の内訳。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndset |> \n  group_by(pH, Calluna) |> \n  summarise(N = length(Weight))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'pH'. You can override using the `.groups`\nargument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n# Groups:   pH [2]\n  pH    Calluna     N\n  <fct> <fct>   <int>\n1 pH3.5 Absent      7\n2 pH3.5 Present     8\n3 pH5.5 Absent     12\n4 pH5.5 Present    14\n```\n:::\n:::\n\n\nデフォルトの平方和と比較の場合、モデルに入れる因子の順序によってF値が変わります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontrasts(dset$pH) = contr.treatment      # Required\ncontrasts(dset$Calluna) = contr.treatment\n# pH first, Calluna second.\nf1 = lm(Weight ~ pH * Calluna, data = dset)\n# Calluna first, pH second.\nf2 = lm(Weight ~ Calluna*pH, data = dset)\nanova(f1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: Weight\n           Df Sum Sq Mean Sq F value    Pr(>F)    \npH          1 39.924  39.924 102.720 3.178e-12 ***\nCalluna     1 26.948  26.948  69.334 5.252e-10 ***\npH:Calluna  1  8.193   8.193  21.081 4.947e-05 ***\nResiduals  37 14.381   0.389                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nanova(f2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: Weight\n           Df Sum Sq Mean Sq F value    Pr(>F)    \nCalluna     1 26.623  26.623  68.498 6.089e-10 ***\npH          1 40.248  40.248 103.555 2.844e-12 ***\nCalluna:pH  1  8.193   8.193  21.081 4.947e-05 ***\nResiduals  37 14.381   0.389                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nデータ数が異なるとき、因子は直交ではないときは、Type-III 平方を使いましょう。\n\n## Type-IIII 平方和の分散分析\n\nType-I 以外の平方を使うとき、car パッケージが必要です。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'car'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    recode\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    some\n```\n:::\n:::\n\n\nさらに、比較は 必ず `contr.sum` にすること。\n\n::: {.cell}\n\n```{.r .cell-code}\ncontrasts(dset$pH) = contr.sum      # Required\ncontrasts(dset$Calluna) = contr.sum # Required\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfullmodel_1 = lm(Weight ~ pH * Calluna, data = dset)\nfullmodel_2 = lm(Weight ~ Calluna * pH, data = dset)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(fullmodel_1, type = \"III\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: Weight\n            Sum Sq Df  F value    Pr(>F)    \n(Intercept) 683.36  1 1758.218 < 2.2e-16 ***\npH           42.64  1  109.711 1.278e-12 ***\nCalluna      17.94  1   46.163 5.336e-08 ***\npH:Calluna    8.19  1   21.081 4.947e-05 ***\nResiduals    14.38 37                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nAnova(fullmodel_2, type = \"III\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: Weight\n            Sum Sq Df  F value    Pr(>F)    \n(Intercept) 683.36  1 1758.218 < 2.2e-16 ***\nCalluna      17.94  1   46.163 5.336e-08 ***\npH           42.64  1  109.711 1.278e-12 ***\nCalluna:pH    8.19  1   21.081 4.947e-05 ***\nResiduals    14.38 37                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nモデルに入れる因子の順序が変わっても、結果は同じです。\n\n\n# 解析のまとめ\n\nデータは `festuca` に入っています。\nType-III 平方和を用いて、分散分析をします。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\nlibrary(emmeans)\nlibrary(ggpubr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'ggpubr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:flextable':\n\n    border, font, rotate\n```\n:::\n\n```{.r .cell-code}\nfestuca |> print(n = Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 × 3\n   Weight pH    Calluna\n    <dbl> <fct> <fct>  \n 1   2.76 pH3.5 Present\n 2   2.39 pH3.5 Present\n 3   3.54 pH3.5 Present\n 4   3.71 pH3.5 Present\n 5   2.49 pH3.5 Present\n 6   4.1  pH3.5 Absent \n 7   2.72 pH3.5 Absent \n 8   2.28 pH3.5 Absent \n 9   4.43 pH3.5 Absent \n10   3.31 pH3.5 Absent \n11   3.21 pH5.5 Present\n12   4.1  pH5.5 Present\n13   3.04 pH5.5 Present\n14   4.13 pH5.5 Present\n15   5.21 pH5.5 Present\n16   5.92 pH5.5 Absent \n17   7.31 pH5.5 Absent \n18   6.1  pH5.5 Absent \n19   5.25 pH5.5 Absent \n20   7.45 pH5.5 Absent \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncontrasts(festuca$pH) = contr.sum      # Required\ncontrasts(festuca$Calluna) = contr.sum # Required\nfullmodel = lm(Weight ~ pH * Calluna, data = festuca)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(fullmodel, type = \"III\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnova Table (Type III tests)\n\nResponse: Weight\n            Sum Sq Df  F value    Pr(>F)    \n(Intercept) 348.20  1 491.0831 1.957e-13 ***\npH           19.98  1  28.1792 7.065e-05 ***\nCalluna      10.21  1  14.4001   0.00159 ** \npH:Calluna    5.40  1   7.6126   0.01397 *  \nResiduals    11.34 16                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n* `(Intercept)` は総平均値の結果です。\n* `pH` は総平均に対する pH の効果です。\n* `Calluna` は総平均に対する Calluna の効果です。\n* `ph:Calluna` は総平均に対する 相互作用 の効果です。\n\n\nCalluna の効果がなかったので、Caluna内のpH に対するペア毎の比較をします。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(fullmodel, pairwise ~ pH|Calluna, data = festuca, adjust = \"tukey\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\nCalluna = Absent:\n pH    emmean    SE df lower.CL upper.CL\n pH3.5   3.37 0.377 16     2.57     4.17\n pH5.5   6.41 0.377 16     5.61     7.20\n\nCalluna = Present:\n pH    emmean    SE df lower.CL upper.CL\n pH3.5   2.98 0.377 16     2.18     3.78\n pH5.5   3.94 0.377 16     3.14     4.74\n\nConfidence level used: 0.95 \n\n$contrasts\nCalluna = Absent:\n contrast      estimate    SE df t.ratio p.value\n pH3.5 - pH5.5    -3.04 0.533 16  -5.705  <.0001\n\nCalluna = Present:\n contrast      estimate    SE df t.ratio p.value\n pH3.5 - pH5.5    -0.96 0.533 16  -1.803  0.0903\n```\n:::\n:::\n\n\nもしも全ペアの比較が必要であれば、次のコードを実行します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemmeans(fullmodel, pairwise ~ pH * Calluna, data = festuca, adjust = \"tukey\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\n pH    Calluna emmean    SE df lower.CL upper.CL\n pH3.5 Absent    3.37 0.377 16     2.57     4.17\n pH5.5 Absent    6.41 0.377 16     5.61     7.20\n pH3.5 Present   2.98 0.377 16     2.18     3.78\n pH5.5 Present   3.94 0.377 16     3.14     4.74\n\nConfidence level used: 0.95 \n\n$contrasts\n contrast                      estimate    SE df t.ratio p.value\n pH3.5 Absent - pH5.5 Absent      -3.04 0.533 16  -5.705  0.0002\n pH3.5 Absent - pH3.5 Present      0.39 0.533 16   0.732  0.8827\n pH3.5 Absent - pH5.5 Present     -0.57 0.533 16  -1.070  0.7118\n pH5.5 Absent - pH3.5 Present      3.43 0.533 16   6.437  <.0001\n pH5.5 Absent - pH5.5 Present      2.47 0.533 16   4.634  0.0014\n pH3.5 Present - pH5.5 Present    -0.96 0.533 16  -1.803  0.3080\n\nP value adjustment: tukey method for comparing a family of 4 estimates \n```\n:::\n:::\n\n\n:::{.callout-tips}\n## 結果の書き方\n\n二元配置分散分析を行った結果、pH (F~(1,16)~ = 32.54, P = 0.00003) と\npH と Calluna の相互作用 (F~(1,16)~ = 7.61, P = 0.0140) に対しては有意の効果があった。\nCalluna (F~(1,16)~ = 0.54, P = 0.4746) に対しては有意な効果がなかった。\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfestuca_summary = festuca |> \n  group_by(pH, Calluna) |> \n  summarise(mean = mean(Weight),\n            sd = sd(Weight),\n            n = length(Weight)) |> \n  mutate(se = sd / sqrt(n - 1)) |> \n  mutate(pH = str_remove(pH, \"pH\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'pH'. You can override using the `.groups`\nargument.\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(festuca_summary) +\n  geom_point(aes(x = pH, y = mean, color = Calluna),\n             size = 2,\n                position = position_dodge(width = 0.2)) +\n  geom_errorbar(aes(x = pH, y = mean,\n                    ymin = mean - se,\n                    ymax = mean + se,\n                    color = Calluna),\n                size = 1,\n                width = 0.25,\n                position = position_dodge(width = 0.2)) +\n  scale_x_discrete(\"pH\") + \n  scale_y_continuous(\"Mean weight (mg)\",\n                     limits = c(0, 8)) +\n  scale_color_viridis_d(end = 0.8) +\n  theme_pubr() +\n  theme(legend.position = c(0,1),\n        legend.justification = c(0,1),\n        legend.background = element_blank())\n```\n\n::: {.cell-output-display}\n![](anova2_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}